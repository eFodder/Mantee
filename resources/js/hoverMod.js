Rickshaw.namespace("Rickshaw.Graph.HoverDetailMod");Rickshaw.Graph.HoverDetailMod=Rickshaw.Class.create({clicked:false,initialize:function(a){var c=this.graph=a.graph;this.xFormatter=a.xFormatter||function(d){return new Date(d*1000).toUTCString()};this.yFormatter=a.yFormatter||function(d){return d===null?d:d.toFixed(2)};var b=this.element=document.createElement("div");b.className="detail";this.visible=true;c.element.appendChild(b);this.lastEvent=null;this._addListeners();this.onShow=a.onShow;this.onHide=a.onHide;this.onRender=a.onRender;this.formatter=a.formatter||this.formatter},formatter:function(e,a,g,c,b,f){return e.name+":&nbsp;"+b},update:function(g){g=g||this.lastEvent;if(!g){return}this.lastEvent=g;if(!g.target.nodeName.match(/^(path|svg|rect|circle)$/)){return}var k=this.graph;var b=g.offsetX||g.layerX;var a=g.offsetY||g.layerY;var d=0;var i=[];var h;this.graph.series.active().forEach(function(n){var m=this.graph.stackedData[d++];if(!m.length){return}var j=k.x.invert(b);var p=d3.scale.linear().domain([m[0].x,m.slice(-1)[0].x]).range([0,m.length-1]);var u=Math.round(p(j));if(u==m.length-1){u--}var r=Math.min(u||0,m.length-1);for(var o=u;o<m.length-1;){if(!m[o]||!m[o+1]){break}if(m[o].x<=j&&m[o+1].x>j){r=Math.abs(j-m[o].x)<Math.abs(j-m[o+1].x)?o:o+1;break}if(m[o+1].x<=j){o++}else{o--}}if(r<0){r=0}var t=m[r];var e=Math.sqrt(Math.pow(Math.abs(k.x(t.x)-b),2)+Math.pow(Math.abs(k.y(t.y+t.y0)-a),2));var l=n.xFormatter||this.xFormatter;var q=n.yFormatter||this.yFormatter;var s={formattedXValue:l(t.x),formattedYValue:q(n.scale?n.scale.invert(t.y):t.y),series:n,value:t,distance:e,order:d,name:n.name};if(!h||e<h.distance){h=s}i.push(s)},this);if(!h){return}h.active=true;var c=h.value.x;var f=h.formattedXValue;this.element.innerHTML="";this.element.style.left=k.x(c)+"px";this.visible&&this.render({points:i,detail:i,mouseX:b,mouseY:a,formattedXValue:f,domainX:c})},hide:function(){this.visible=false;this.element.classList.add("inactive");if(typeof this.onHide=="function"){this.onHide()}},show:function(){this.visible=true;this.element.classList.remove("inactive");if(typeof this.onShow=="function"){this.onShow()}},render:function(f){var j=this.graph;var i=f.points;var g=i.filter(function(l){return l.active}).shift();if(g.value.y===null){return}var e=g.formattedXValue;var h=g.formattedYValue;this.element.innerHTML="";this.element.style.left=j.x(g.value.x)+"px";var c=document.createElement("div");c.className="x_label";c.innerHTML=e;this.element.appendChild(c);var k=document.createElement("div");k.className="item";var d=g.series;var a=d.scale?d.scale.invert(g.value.y):g.value.y;k.innerHTML=this.formatter(d,g.value.x,a,e,h,g);k.style.top=this.graph.y(g.value.y0+g.value.y)+"px";if(this.clicked){this.clicked=false;Mantee.app.getController("Current").getPointValue(e)}this.element.appendChild(k);var b=document.createElement("div");b.className="dot";b.style.top=k.style.top;b.style.borderColor=d.color;this.element.appendChild(b);if(g.active){k.className="item active";b.className="dot active"}this.show();if(typeof this.onRender=="function"){this.onRender(f)}},_addListeners:function(){this.graph.element.addEventListener("mousemove",function(a){this.visible=true;this.update(a)}.bind(this),false);this.graph.element.addEventListener("click",function(a){this.clicked=true;this.visible=true;this.update(a)}.bind(this),false);this.graph.onUpdate(function(){this.update()}.bind(this));this.graph.element.addEventListener("mouseout",function(a){if(a.relatedTarget&&!(a.relatedTarget.compareDocumentPosition(this.graph.element)&Node.DOCUMENT_POSITION_CONTAINS)){this.hide()}}.bind(this),false)}});